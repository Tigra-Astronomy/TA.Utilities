
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
      
      
      
        <link rel="prev" href="../Versioning/">
      
      
        <link rel="next" href="../Core/SemanticVersion/">
      
      
      <link rel="icon" href="../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.6.1, mkdocs-material-9.6.20">
    
    
      
        <title>Diagnostics and Logging - Timtek Utilities</title>
      
    
    
      <link rel="stylesheet" href="../assets/stylesheets/main.e53b48f4.min.css">
      
      


    
    
      
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
    <script>__md_scope=new URL("..",location),__md_hash=e=>[...e].reduce(((e,_)=>(e<<5)-e+_.charCodeAt(0)),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
    
  </head>
  
  
    <body dir="ltr">
  
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#diagnostics-and-logging" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
      <div data-md-color-scheme="default" data-md-component="outdated" hidden>
        
      </div>
    
    
      

  

<header class="md-header md-header--shadow" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href=".." title="Timtek Utilities" class="md-header__button md-logo" aria-label="Timtek Utilities" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54"/></svg>

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3zm0 5h18v2H3zm0 5h18v2H3z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            Timtek Utilities
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              Diagnostics and Logging
            
          </span>
        </div>
      </div>
    </div>
    
    
      <script>var palette=__md_get("__palette");if(palette&&palette.color){if("(prefers-color-scheme)"===palette.color.media){var media=matchMedia("(prefers-color-scheme: light)"),input=document.querySelector(media.matches?"[data-md-color-media='(prefers-color-scheme: light)']":"[data-md-color-media='(prefers-color-scheme: dark)']");palette.color.media=input.getAttribute("data-md-color-media"),palette.color.scheme=input.getAttribute("data-md-color-scheme"),palette.color.primary=input.getAttribute("data-md-color-primary"),palette.color.accent=input.getAttribute("data-md-color-accent")}for(var[key,value]of Object.entries(palette.color))document.body.setAttribute("data-md-color-"+key,value)}</script>
    
    
    
      
      
        <label class="md-header__button md-icon" for="__search">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        </label>
        <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
        <button type="reset" class="md-search__icon md-icon" title="Clear" aria-label="Clear" tabindex="-1">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/></svg>
        </button>
      </nav>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" tabindex="0" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list" role="presentation"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
      
    
    
      <div class="md-header__source">
        <a href="https://github.com/Tigra-Astronomy/TA.Utilities" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 7.0.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2025 Fonticons, Inc.--><path d="M439.6 236.1 244 40.5c-5.4-5.5-12.8-8.5-20.4-8.5s-15 3-20.4 8.4L162.5 81l51.5 51.5c27.1-9.1 52.7 16.8 43.4 43.7l49.7 49.7c34.2-11.8 61.2 31 35.5 56.7-26.5 26.5-70.2-2.9-56-37.3L240.3 199v121.9c25.3 12.5 22.3 41.8 9.1 55-6.4 6.4-15.2 10.1-24.3 10.1s-17.8-3.6-24.3-10.1c-17.6-17.6-11.1-46.9 11.2-56v-123c-20.8-8.5-24.6-30.7-18.6-45L142.6 101 8.5 235.1C3 240.6 0 247.9 0 255.5s3 15 8.5 20.4l195.6 195.7c5.4 5.4 12.7 8.4 20.4 8.4s15-3 20.4-8.4l194.7-194.7c5.4-5.4 8.4-12.8 8.4-20.4s-3-15-8.4-20.4"/></svg>
  </div>
  <div class="md-source__repository">
    GitHub
  </div>
</a>
      </div>
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    



<nav class="md-nav md-nav--primary" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href=".." title="Timtek Utilities" class="md-nav__button md-logo" aria-label="Timtek Utilities" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54"/></svg>

    </a>
    Timtek Utilities
  </label>
  
    <div class="md-nav__source">
      <a href="https://github.com/Tigra-Astronomy/TA.Utilities" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 7.0.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2025 Fonticons, Inc.--><path d="M439.6 236.1 244 40.5c-5.4-5.5-12.8-8.5-20.4-8.5s-15 3-20.4 8.4L162.5 81l51.5 51.5c27.1-9.1 52.7 16.8 43.4 43.7l49.7 49.7c34.2-11.8 61.2 31 35.5 56.7-26.5 26.5-70.2-2.9-56-37.3L240.3 199v121.9c25.3 12.5 22.3 41.8 9.1 55-6.4 6.4-15.2 10.1-24.3 10.1s-17.8-3.6-24.3-10.1c-17.6-17.6-11.1-46.9 11.2-56v-123c-20.8-8.5-24.6-30.7-18.6-45L142.6 101 8.5 235.1C3 240.6 0 247.9 0 255.5s3 15 8.5 20.4l195.6 195.7c5.4 5.4 12.7 8.4 20.4 8.4s15-3 20.4-8.4l194.7-194.7c5.4-5.4 8.4-12.8 8.4-20.4s-3-15-8.4-20.4"/></svg>
  </div>
  <div class="md-source__repository">
    GitHub
  </div>
</a>
    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href=".." class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Home
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../Overview/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Overview
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../Versioning/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Versioning
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
    
  
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" type="checkbox" id="__toc">
      
      
        
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          
  
  
  <span class="md-ellipsis">
    Diagnostics and Logging
    
  </span>
  

          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="./" class="md-nav__link md-nav__link--active">
        
  
  
  <span class="md-ellipsis">
    Diagnostics and Logging
    
  </span>
  

      </a>
      
        

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#consoleloggerservice-implements-ilog" class="md-nav__link">
    <span class="md-ellipsis">
      ConsoleLoggerService implements ILog
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#logging" class="md-nav__link">
    <span class="md-ellipsis">
      Logging
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#two-stage-approach-to-logging" class="md-nav__link">
    <span class="md-ellipsis">
      Two-stage Approach to Logging
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#a-note-on-semantic-logging" class="md-nav__link">
    <span class="md-ellipsis">
      A Note on Semantic Logging
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#seq-special-considerations" class="md-nav__link">
    <span class="md-ellipsis">
      Seq Special Considerations
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Seq Special Considerations">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#tldr" class="md-nav__link">
    <span class="md-ellipsis">
      TL;DR
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#log-correlation" class="md-nav__link">
    <span class="md-ellipsis">
      Log Correlation
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#custom-severity-levels" class="md-nav__link">
    <span class="md-ellipsis">
      Custom Severity Levels
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_5" >
        
          
          <label class="md-nav__link" for="__nav_5" id="__nav_5_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    Core
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_5_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_5">
            <span class="md-nav__icon md-icon"></span>
            Core
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../Core/SemanticVersion/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    SemanticVersion
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../Core/Maybe/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Maybe
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../Core/Octet/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Octet
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../Core/Code%20Contracts/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Code Contracts
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../Core/Display%20Equivalent/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Display Equivalent
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../Core/ASCII%20Mnemonic%20Expansion/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    ASCII Mnemonic Expansion
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../Core/Async%20Helpers/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Async Helpers
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../Core/Property%20Binding/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Property Binding
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../Core/Finite%20State%20Machine/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Finite State Machine
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_6" >
        
          
          <label class="md-nav__link" for="__nav_6" id="__nav_6_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    Areas for Improvement
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_6_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_6">
            <span class="md-nav__icon md-icon"></span>
            Areas for Improvement
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../Areas%20for%20Improvement/FSM%20SOLID%20Analysis/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    FSM SOLID Analysis
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#consoleloggerservice-implements-ilog" class="md-nav__link">
    <span class="md-ellipsis">
      ConsoleLoggerService implements ILog
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#logging" class="md-nav__link">
    <span class="md-ellipsis">
      Logging
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#two-stage-approach-to-logging" class="md-nav__link">
    <span class="md-ellipsis">
      Two-stage Approach to Logging
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#a-note-on-semantic-logging" class="md-nav__link">
    <span class="md-ellipsis">
      A Note on Semantic Logging
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#seq-special-considerations" class="md-nav__link">
    <span class="md-ellipsis">
      Seq Special Considerations
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Seq Special Considerations">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#tldr" class="md-nav__link">
    <span class="md-ellipsis">
      TL;DR
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#log-correlation" class="md-nav__link">
    <span class="md-ellipsis">
      Log Correlation
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#custom-severity-levels" class="md-nav__link">
    <span class="md-ellipsis">
      Custom Severity Levels
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          
            <div class="md-content" data-md-component="content">
              <article class="md-content__inner md-typeset">
                
                  


  
  


<h1 id="diagnostics-and-logging">Diagnostics and Logging<a class="headerlink" href="#diagnostics-and-logging" title="Permanent link">&para;</a></h1>
<h2 id="consoleloggerservice-implements-ilog"><code>ConsoleLoggerService</code> implements <code>ILog</code><a class="headerlink" href="#consoleloggerservice-implements-ilog" title="Permanent link">&para;</a></h2>
<p>One step up from the <code>DegenerateLoggerService</code>, enables easy rudimentatary logging to the console
without depending on any logging framework or configurations files. This is meant to be a light-weight
stop-gap logging solution for projects that never get large enough to warrant full structured logging.</p>
<p><code>ConsoleLoggerService</code> is fully compatible with and interchangeable with any logging back-end built on the <code>ILog</code> interface.
The <em>Liskov Subsitution Principle</em> is observed, so it remains easy to switch logging back-ends just by changing a binding in your
IOC container. Start yoru console app with a <code>ConsoleLoggingService</code>, then when it becomes a limitation, simply plug-in a full-blown
logger such as the NLog implementation founf in <code>TA.Utils.Logging.NLog</code>.</p>
<h2 id="logging">Logging<a class="headerlink" href="#logging" title="Permanent link">&para;</a></h2>
<p>Logging is a big deal. It is an essential part of debugging during development,
but can also be really useful or even essential in production.
It needs to be easy to use, or developer's won't use it.
It needs to not re-invent any wheels. There are plenty of good logging services out there.</p>
<p>Our approach to logging is this:
1. No dependency on any particular logging framework.
   We define an abstract interface that can be adapted to any back-end logging engine.
2. Follow the KISS principle: "Keep it simple, stupid".
   Logging should be easy enough that people will use it, but have enough flexibility to be useful in the real world.</p>
<p>We provide an abstract fluent builder pattern for easily constructing log entries and which provides an extensibility point
for creating extension methods.</p>
<p>Our fluent builder interface supports <em>semantic logging</em> which enables the creation of rich logging data.</p>
<p>Item (1) notwithstanding, we have based our fluent builder API loosely on the one used by NLog.
We think it is the best balance of simplicity and flexibility. However, we do not depend on NLog
and have made our own abstract interfaces that can target any logging framework.</p>
<p>The <code>TA.Utils.Core.Diagnostics</code> namespace defines a pair of interfaces, <code>ILog</code> and <code>IFluentLogBuilder</code>,
that define an abstract logging service which does not depend on any particular back-end.</p>
<p>Libraries can perform logging through these interfaces without ever taking a dependency on any logging imnplementation.
The actual implementation can be injected at runtime, typically in a constructor parameter.
The policy decision about which logging engine to use can be taken in the top level composition root of the application.</p>
<p>The fluent interface defined in <code>IFluentLogBuilder</code> was modeled on the NLog fluent interface, so it is a very natural fit.
However, the interface has enough flexibility to adapt to other logging backends without too much trouble.]</p>
<p>A null implementation is provided in <code>DegenerateLoggerService</code> and <code>DegenerateLogBuilder</code>.
The two classes do essentially nothing and produce no output; they are a data sink.
Libraries can choose to use this as their default logging implementation, which is easier than checking
whether the logger is null every time it is used.</p>
<pre><code class="language-csharp">public class MyClassThatUsesLogging
{
    private ILog Log;

    // Construct an instance and optionally inject the logging service implementation.
    public MyClassThatUsesLogging(ILog logService = null)
    {
        // Use the supplied logging service, or fall back to the degenerate logger.
        this.Log = logService ?? new DegenerateLoggerService();
    }

    public void MethodThatGeneratesLogEntries()
    {
        Log.Info()
            .Message(&quot;I am loosely coupled. I do not depend on any logging back-end.&quot;)
            .Write();
    }
}
</code></pre>
<p>The interface supports semantic logging. You can use a simple format string like so:</p>
<pre><code class="language-csharp">log.Info().Message(&quot;Sending data {0}&quot;, data).Write();
log.Error().Message(&quot;Exception {0} occurred with error code {1}&quot;, ex.Message, errorCode).Write();
</code></pre>
<p>But this leaves useful information on the table. Extra rich information can be included like so:</p>
<pre><code class="language-csharp">log.Info().Message(&quot;Sending data {data}&quot;, data).Write();
log.Error()
    .Message(&quot;Exception {exception} occurred with error code {error}&quot;)
    .Property(&quot;exception&quot;, ex.Message)
    .Property(&quot;error&quot;, errorCode)
    .Exception(ex)
    .Write();
</code></pre>
<p>In both statements, we are adding property-value pairs to the log.
In the first <code>Log.Info()</code> statement this is implicit, whereas in the <code>Log.Error()</code> statement it is made explicit.
This extra information may or may not be used by the log renderer, but if its not there then it can't be used!
So if in doubt, include extra information where it is appropriate.</p>
<p>Again, this feature set is native to NLog so makes for a very lightweight adaptor.
When developing adaptors for other logging frameworks, every attempt shouldbe made to preserve as much of the information as possible.</p>
<h2 id="two-stage-approach-to-logging">Two-stage Approach to Logging<a class="headerlink" href="#two-stage-approach-to-logging" title="Permanent link">&para;</a></h2>
<p>Think of logging as occurring in two distinct stages.</p>
<ol>
<li>You build the log entry using <code>IFluentLogBuilder</code>, adding all of the relevant information as <em>Properties</em> of the log entry.</li>
<li>You send the log entry to the back-end to be rendered on one or more <em>Targets</em>.</li>
</ol>
<p>Each target may use none, some or all of the information you provided and it may even augment it with additional metadata.
As a library developer, you shouldn't be concerned with how the entry will be rendered, stored or how it will be formatted.
You should concentrate only on including as much relevant information as is appropriate in your log entries.</p>
<p>Multiple targets may be in use and different targets will produce different output from the exact same log entry.
For example:</p>
<ul>
<li>A file target may include a timestamp and perform log file rotation so that a new file is created each day.</li>
<li>A debug output stream may include the name of the class where the log entry originated and print only the message portion.</li>
<li>A console logger may write different lines in different colours accoring to the severity level.</li>
<li>A syslog target may include the host name of the originating computer.</li>
<li>A NoSQL database renderer may write out all of the properties as a JSON document.</li>
</ul>
<p>In most cases, the way in which log data is ultimately rendered is outside of application control.
Typically, a configuration file is used. The configuration file may be added or changed post-deployment.
As a library developer, you must accept that you have little to no control over this.
Just concentrate on including appropriate and useful information and don't think about formatting or storage.</p>
<h2 id="a-note-on-semantic-logging">A Note on Semantic Logging<a class="headerlink" href="#a-note-on-semantic-logging" title="Permanent link">&para;</a></h2>
<p>If you have always thought about logging as <code>Console.WriteLine()</code> statements, then you have probably focussed
on formatting your output and given little thought to the content.
You might struggle to see the point of semantic logging and you might be due for a paradigm shift.
Forget about how your log output <em>looks</em> and focus on what data it <em>contains</em>.
Your responsibility as the log entry creator is to include as much relevant data as possible.
Assume that formatting (rendering) and filtering will be done elsewhere and is outside your control.</p>
<p>How useful would it be, for example, if when you logged an exception,
it included all the exception metadata, any inner exceptions, and a full stack trace?
You might struggle to achieve this using <code>Console.WriteLine()</code>.
In our paradigm, that is as simple as adding <code>.Exception(ex)</code> to your log builder statement.</p>
<p>Having done that, you might think "so what?". The log file produced still only shows the exception message,
so what was the point? We struggled with this oursleves. You put the data in, but it doesn't easily come out
in a meaningful way.
Then one day we were "red-pilled" by <a href="https://datalust.co/seq" title="Seq semantic logging service">Seq</a>.
We discovered the truth that flat files are an inadequate solution for rendering log output.</p>
<p>We had our "Aha!" moment the first time we logged and exception to Seq and were able to view the full stack trace.
There is so much more to Seq, but that was the moment we understood semantic logging.
Seq unlocks the full usefulness of all that data and will change the way you write log entries.
Once you see the truth, Neo, you cannot go back. You cannot "unsee" Seq.
We realised that merely by changing a configuration file, i.e. with zero code impact,
we could send our log entries across the network to a log server that could store them in a SQL database.
We could then use our web browser to log into that server to view the log data, in real time,
and be able to view, search, filter and query based on the full data that we put into our log entries.</p>
<p>Seq can be used with our logging abstraction and the NLog adapter, and using the NLog.Targets.Seq NuGet package.
You can then configure a Seq target for NLog in your NLog.config file (there is no special code needed).</p>
<h2 id="seq-special-considerations">Seq Special Considerations<a class="headerlink" href="#seq-special-considerations" title="Permanent link">&para;</a></h2>
<p>We highly recommend Seq. It's free for a single user and can be set up in a few moments using Docker. This section contains some of our explorations with Seq.</p>
<h3 id="tldr">TL;DR<a class="headerlink" href="#tldr" title="Permanent link">&para;</a></h3>
<ul>
<li>Add and ambient property called <code>CorrelationId</code> to all log entries and set it to a new <code>Guid</code> each time the program starts. This helps you find all the log entries relating to a particular run of the program.</li>
<li>Register a <em>Last Chance Exception Handler</em> as soon as your program starts; this will let you catch and log any program crashes as they happen. Have your handler log the exception and display a message to the user with the <code>CorrelationId</code> that they should use in any bug reports. This will make it trivial to find the error in the logs.</li>
<li>When reporting a <code>CorrelationId</code> to the user, you can use just the last few digits (we use 6) of the <code>CorrelationId</code>, this is usually enough to uniquely identify a log session.</li>
<li>Use <em>dependency injection</em> and have your IOC container create loggers for injection into class constructors.</li>
</ul>
<p>This method may be useful. It was written for use with Ninject, but you can distill out the approach  of looking at the stack frame to work out the calling type and set the logger name from that.</p>
<pre><code class="language-csharp">/// &lt;summary&gt;
///     Get an instance of a service from the dependency injection kernel.
///     Special handling for logging services.
/// &lt;/summary&gt;
/// &lt;typeparam name=&quot;TService&quot;&gt;The type of service requested.&lt;/typeparam&gt;
/// &lt;returns&gt;An instance of the requested service.&lt;/returns&gt;
public static TService Get&lt;TService&gt;()
{
   if (typeof(ILog).IsAssignableFrom(typeof(TService)))
   {
       // Special handling for request for ILog.
       // Try to determine the calling type by examining the stack, and pass it to the kernel as a binding parameter.
       var callerStackFrame = new StackFrame(1);
       var callingMethod = callerStackFrame.GetMethod();
       // MethodBase.ReflectedType is more reliable than the direct Type property and less likely to return an &quot;un-utterable name&quot;.
       var callerType = callingMethod.ReflectedType;
       var callerTypeName = callerType?.Name ?? string.Empty;
       if (!string.IsNullOrEmpty(callerTypeName))
       {
           var logServiceNameParameter = new Parameter(LogSourceParameterName, callerTypeName, false);
           return Kernel.Get&lt;TService&gt;(logServiceNameParameter);
       }
   }

   // For all other requests, simply request the type from the DI kernel.
    return Kernel.Get&lt;TService&gt;();
}
</code></pre>
<h3 id="log-correlation">Log Correlation<a class="headerlink" href="#log-correlation" title="Permanent link">&para;</a></h3>
<p>We use a global static readonly GUID called something like <code>CorrelationId</code>.
We initialize this with a new <code>Guid</code> as early as possible in the program execution, usually in a static initializer, so that it has a new value for each run of the program. We then add this to every instance of <code>ILog</code> as an Ambient Property.</p>
<p>This way, every log entry we write contains a <code>CorrelationId</code> value which is unique for each run of the program. In Seq, you can Expand a log entry, find the <code>CorrelationId</code> property, and click the checkmark next to it, then select "Find". This will find all the log entries for one run of the program.</p>
<p><img alt="Correlation of log entries" src="Assets/Find-CorrelationId.png" /></p>
<h3 id="custom-severity-levels">Custom Severity Levels<a class="headerlink" href="#custom-severity-levels" title="Permanent link">&para;</a></h3>
<p>NLog has fice severity levels: <code>Trace</code>, <code>Debug</code>, <code>Info</code>, <code>Warning</code>, <code>Error</code> and a pseudo-level <code>Fatal</code> which actually causes the program to exit, so can't really be used as a normal severity level.</p>
<p>We find this a bit limiting and would like to be able to create our own levels, such as <code>Note</code> and <code>Important</code>.</p>
<p>The <code>NLog.Targets.Seq</code> logging target has support for this, and we also support it in our <code>ILog</code> interface via the <code>ILog.Level(string levelName)</code> method.</p>
<p>The way this works is to create an additional log event property, by default named "CustomLevel", containing the level name. The Seq target then uses this property as the level when it posts the data to the Seq server. If the default property name is no good for some reason, it can be changed using a <code>LogServiceOptions</code> instance and setting <code>LogServiceOptions.CustomSeverityPropertyName</code> property to the preferred name, like so:</p>
<pre><code class="language-csharp">var options = LogServiceOptions.DefaultOptions.CustomSeverityPropertyName(&quot;SeqLevel&quot;);
var log = new LoggingService(options);
</code></pre>
<p>A small bit of configuration is needed to wire this up, in the Seq target in the <code>NLog.config</code> file, like so:</p>
<pre><code class="language-xml">      \\&lt;target xsi:type=&quot;Seq&quot; name=&quot;seq&quot; 
      serverUrl=&quot;http://your-server-url:5341&quot;
      apiKey=&quot;your-seq-api-key&quot;
      seqLevel=&quot;${event-properties:CustomLevel:whenEmpty=${level}}&quot;\\&gt;
</code></pre>
<p>The magic is in <code>seqLevel="${event-properties:CustomLevel:whenEmpty=${level}}</code></p>
<p>This uses the value of <code>CustomLevel</code> as the Seq level, unless it is empty or missing, in which case it defaults to the NLog level.</p>
<p>In targets other than Seq, this will just appear as yet another log event property.</p>












                
              </article>
            </div>
          
          
<script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script>
        </div>
        
      </main>
      
        <footer class="md-footer">
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    
    
      
      <script id="__config" type="application/json">{"base": "..", "features": [], "search": "../assets/javascripts/workers/search.973d3a69.min.js", "tags": null, "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}, "version": {"provider": "mike"}}</script>
    
    
      <script src="../assets/javascripts/bundle.f55a23d4.min.js"></script>
      
    
  </body>
</html>